<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>特許検索式ブロックビルダー</title>

  <!-- CSS 読み込み -->
  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/layout.css" />
  <link rel="stylesheet" href="css/panel.css" />
  <link rel="stylesheet" href="css/block-card.css" />
  <link rel="stylesheet" href="css/controls.css" />
  <link rel="stylesheet" href="css/state.css" />
  <link rel="stylesheet" href="css/title.css" />
  <link rel="stylesheet" href="css/workspace-1col.css" />
  <link rel="stylesheet" href="css/layout-fix.css" />
  <link rel="stylesheet" href="css/builder.css" />
</head>
<body>
  <div class="workspace workspace--1col">
    <div class="workspace__left">
      <div class="app">
    <section class="panel panel--input">
      <header class="panel__header">
        <h2>式入力とブロック化</h2>
      </header>

      <textarea
        id="expr-input"
        class="expr-input"
        placeholder="例1) NB = 基地局+NB+eNB&#10;例2) H04W16/24+H04W36/00"
      ></textarea>

      <div class="builder-input-row">
        <div class="builder-kind-select">
          <label>
            <input type="radio" name="builder-kind" value="word" checked id="builder-kind-word" />
            語ブロック
          </label>
          <label>
            <input type="radio" name="builder-kind" value="class" id="builder-kind-class" />
            分類ブロック
          </label>
          <label>
            <input type="radio" name="builder-kind" value="block" id="builder-kind-block" />
            式から一括
          </label>
        </div>
        <button id="btn-parse" type="button" class="btn" title="選択中のモードでブロックを生成します">
          生成
        </button>
        <button id="btn-reset-words" type="button" class="btn" title="語ブロックと分類ブロックをすべて削除します">
          語削除
        </button>
        <button id="btn-reset-equations" type="button" class="btn" title="式ブロックをすべて削除します">
          式削除
        </button>
      </div>

      <div class="panel__help">
        <strong>入力例</strong><br />
        語ブロック: <code>NB = 基地局+NB+eNB</code> または <code>基地局+NB+eNB</code><br />
        分類ブロック: <code>H04W16/24+H04W36/00</code><br />
        式から一括: <code>(A+B)/TX*(A+B+C)/TX*(F+D)/TX*S/TX</code><br />
        <small>分類ブロックでは <code>*</code> や近傍演算（<code>10n</code>, <code>10c</code>）は使用できません。</small>
      </div>

      <div id="input-errors" class="error-message"></div>
    </section>

    <section class="panel panel--words">
      <header class="panel__header">
        <h2>語・分類ブロック一覧</h2>
      </header>
      <div id="word-list" class="block-list block-list--words"></div>
    </section>

    <section class="panel panel--equations">
      <header class="panel__header">
        <h2>式ブロック一覧</h2>
      </header>

      <div class="panel-equation-body">
        <!-- 左: Equation ブロック一覧 -->
        <div id="equation-list" class="block-list block-list--equations"></div>

        <aside id="builder-panel" class="builder-panel">
          <h3 class="builder-panel__title">式ビルダー</h3>

          <div class="builder-panel__section">
            <div class="builder-panel__section-title">素材</div>
            <ul id="builder-selection-list" class="builder-selection-list">
            </ul>
            <div class="builder-panel__hint">
              語ブロックまたは式ブロックをクリックして素材に追加（最大3個）<br />
              順序変更は ↑ / ↓ ボタン
            </div>
          </div>

          <div class="builder-panel__section">
            <div class="builder-panel__section-title">近傍設定</div>
            <div class="builder-panel__field">
              <span class="builder-panel__label">形式</span>
              <label>
                <input type="radio" name="prox-mode" value="n" checked />
                n (NNn)
              </label>
              <label>
                <input type="radio" name="prox-mode" value="c" />
                c (NNc)
              </label>
            </div>
            <div class="builder-panel__field">
              <label class="builder-panel__label" for="prox-k-input">
                近傍数
              </label>
              <input
                id="prox-k-input"
                type="number"
                min="0"
                max="99"
                value="10"
                class="builder-panel__number"
              />
            </div>
          </div>

          <div class="builder-panel__section">
            <div class="builder-panel__section-title">式作成</div>
            <div class="builder-panel__buttons">
              <button id="btn-build-l1" type="button" class="btn-small" title="選択中の素材1つから単独式を作成">
                単独
              </button>
              <button id="btn-build-prox2" type="button" class="btn-small" title="選択中の素材2つから2語近傍式を作成">
                2近傍
              </button>
              <button id="btn-build-prox3" type="button" class="btn-small" title="選択中の素材3つから3語近傍式を作成">
                3近傍
              </button>
            </div>
            <div class="builder-panel__buttons">
              <button id="btn-build-or" type="button" class="btn-small" title="選択中の素材を和（OR）で結合">
                和結合
              </button>
              <button id="btn-build-and" type="button" class="btn-small" title="選択中の素材を積（AND）で結合">
                積結合
              </button>
            </div>
          </div>

          <div class="builder-panel__section">
            <div class="builder-panel__section-title">更新</div>
            <div class="builder-panel__buttons">
              <button id="btn-builder-renew" type="button" class="btn-small" title="語ブロックの変更を式ブロックに反映">
                反映
              </button>
            </div>
          </div>

          <!-- ビルダー専用メッセージ -->
          <div id="builder-message" class="builder-panel__message"></div>
        </aside>
      </div>
    </section>
      </div>
    </div>
  </div>

  <!-- JS 読み込み（グローバルクラス順） -->
  <script src="js/core/expr-node.js"></script>
  <script src="js/core/block.js"></script>
  <script src="js/core/block-repository.js"></script>
  <script src="js/core/render-context.js"></script>
  <!-- ★ 追加 -->
  <script src="js/core/token-generator.js"></script>

  <script src="js/parser/token.js"></script>
  <script src="js/parser/lexer.js"></script>
  <script src="js/parser/parser.js"></script>

  <script src="js/services/expression-service.js"></script>
  <!-- 新機能: 式の正規化とブロック変換 -->
  <script src="js/services/expression-normalizer.js"></script>
  <script src="js/services/word-normalizer.js"></script>
  <script src="js/services/expression-block-converter.js"></script>

  <script src="js/ui/dom-utils.js"></script>
  <script src="js/ui/view-renderer.js"></script>
  <script src="js/ui/proximity-panel.js"></script>
  <script src="js/ui/app-controller.js"></script>

  <script src="js/main.js"></script>
</body>
</html>
